cat > nginx.yaml << 'EOF'
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app: nginx
  ports:
  - port: 80
    targetPort: 80
  type: LoadBalancer
EOF

===============
kubectl apply -f nginx.yaml


kubectl get pods
kubectl get svc nginx-service

Install Prometheus and Grafana via Helm
--
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo add grafana https://grafana.github.io/helm-charts
helm repo update

--
kubectl create namespace monitoring

helm install prometheus prometheus-community/kube-prometheus-stack      --namespace monitoring      --set grafana.service.type=LoadBalancer      --set prometheus.service.type=LoadBalancer      --set grafana.adminPassword=admin123


--
kubectl get pods -n monitoring

--
kubectl get services -n monitoring --watch

GRAFANA_URL=$(kubectl get service prometheus-grafana -n monitoring -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')
PROMETHEUS_URL=$(kubectl get service prometheus-kube-prometheus-prometheus -n monitoring -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')
NGINX_URL=$(kubectl get service nginx-service -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')

echo "Grafana: http://$GRAFANA_URL (admin/admin123)"
echo "Prometheus: http://$PROMETHEUS_URL:9090"
echo "NGINX: http://$NGINX_URL"


--
Verification:
Access the URLs in your browser.

Grafana dashboard: admin / admin123
Prometheus dashboard
NGINX welcome page
===

Activity 6 — Generate Load Traffic
Objective: Simulate requests to visualize metrics.

Steps:

for i in {1..500}; do
  curl -s http://$NGINX_URL > /dev/null &
  if (( i % 50 == 0 )); then
    wait
    echo "Completed $i requests"
  fi
done
wait

===

Verification:
Grafana dashboards should now display CPU, memory, and network activity under:

Kubernetes / Compute Resources / Cluster
Kubernetes / Compute Resources / Namespace (Pods)
Node Exporter / Nodes
==

Steps:

Access Grafana using the LoadBalancer URL.
Navigate to:
Dashboards → Browse → Kubernetes / Compute Resources / Cluster
Dashboards → Kubernetes / Compute Resources / Namespace (Workloads)
Observe CPU, memory, and request throughput trends.
===

Activity 8 — Cleanup
Objective: Delete all resources to prevent ongoing AWS charges.

Steps:
Run the following command:

eksctl delete cluster --name nginx-demo

Verification:
Once deletion is complete, verify no clusters exist:

eksctl get cluster
